define("mod_smartlink/smartlink_actions",["jquery","core/str","core/ajax"],(function($,Str,Ajax){class SmartLinkActions{constructor(prompts,courseid,instanceid){this.prompts=Object.values(prompts),this.courseid=courseid,this.instanceid=instanceid,this.contextid=1,this.init()}init(){$(".modal").on("hidden.bs.modal",(function(){$('form[name="custom-prompt-form"]')[0].reset()})),$("[data-dismiss='modal']").on("click",(function(){$('form[name="custom-prompt-form"]')[0].reset()})),$(document).click((async function(e){if("ownPromptModal"===e.target.id){var confimationMsg=await Str.get_string("prompt_modal_close_warning","smartlink");confirm(confimationMsg)&&$(".custom-prompt-modal").modal("toggle")}else if("responseModal"===e.target.id){confimationMsg=await Str.get_string("response_modal_close_warning","smartlink");confirm(confimationMsg)&&$(".response-modal").modal("toggle")}})),$(".run-prompt-btn").click(function(e){e.preventDefault();var attrVal=$(e.currentTarget).attr("data-id"),promptSetting=this.prompts.find((prompt=>prompt.id==attrVal));promptSetting&&this.getAiResponse({promptid:promptSetting.id,courseid:this.courseid,instanceid:this.instanceid})}.bind(this)),$(".submit-own-prompt-btn").click(function(e){e.preventDefault();var promptVal=$("textarea[name='prompt']").val();this.getAiResponse({prompt:promptVal,courseid:this.courseid,instanceid:this.instanceid})}.bind(this))}getAiResponse(promptdata){$("#loader").removeClass("d-none"),Ajax.call([{methodname:"mod_smartlink_prompt_openai",args:{contextid:this.contextid,jsondata:JSON.stringify(promptdata)},done:this.handleResponse.bind(this),fail:this.handleFailure.bind(this)}])}handleResponse(response){$("#loader").addClass("d-none");var responseObj=JSON.parse(response);if($("#ownPromptModal").is(":visible")&&$("#ownPromptModal").modal("toggle"),0==responseObj.success)alert(responseObj.message);else{var data=responseObj.data;$(".prompt-desc").html(data.description),$(".prompt-text").html(data.prompt_text),$(".ai-response").html(data.result.replace(/\n/g,"<br/>")),$("#responseModal").modal("toggle")}}handleFailure(response){$("#loader").addClass("d-none");var responseObj=JSON.parse(response);alert(responseObj.message)}}return{init:function(prompts,courseid,instanceid){return new SmartLinkActions(prompts,courseid,instanceid)}}}));

//# sourceMappingURL=smartlink_actions.min.js.map