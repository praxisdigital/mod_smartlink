{"version":3,"file":"smartlink_actions.min.js","sources":["../src/smartlink_actions.js"],"sourcesContent":["define([\"jquery\", \"core/str\", \"core/ajax\"], function ($, Str, Ajax) {\n  class SmartLinkActions {\n    constructor(prompts, courseid, instanceid) {\n      this.prompts = Object.values(prompts);\n      this.courseid = courseid;\n      this.instanceid = instanceid;\n      this.contextid = 1;\n      this.init();\n    }\n\n    init() {\n      $(\".modal\").on(\"hidden.bs.modal\", function () {\n        $('form[name=\"custom-prompt-form\"]')[0].reset();\n      });\n\n      $(\"[data-dismiss='modal']\").on(\"click\", function () {\n        $('form[name=\"custom-prompt-form\"]')[0].reset();\n      });\n\n      //handle modal outside click confirmation\n      $(document).click(async function (e) {\n        if (e.target.id === \"ownPromptModal\") {\n          var confimationMsg = await Str.get_string(\"prompt_modal_close_warning\", \"smartlink\");\n          if (confirm(confimationMsg)) {\n            $(\".custom-prompt-modal\").modal(\"toggle\");\n          }\n        } else if (e.target.id === \"responseModal\") {\n          var confimationMsg = await Str.get_string(\"response_modal_close_warning\", \"smartlink\");\n          if (confirm(confimationMsg)) {\n            $(\".response-modal\").modal(\"toggle\");\n          }\n        }\n      });\n\n      $(\".run-prompt-btn\").click(\n        function (e) {\n          e.preventDefault();\n          var attrVal = $(e.currentTarget).attr(\"data-id\");\n          var promptSetting = this.prompts.find((prompt) => prompt.id == attrVal);\n          if (promptSetting) {\n            this.getAiResponse({ promptid: promptSetting.id, courseid: this.courseid, instanceid: this.instanceid });\n          }\n        }.bind(this)\n      );\n      $(\".submit-own-prompt-btn\").click(\n        function (e) {\n          e.preventDefault();\n          var promptVal = $(\"textarea[name='prompt']\").val();\n          this.getAiResponse({ prompt: promptVal, courseid: this.courseid, instanceid: this.instanceid });\n        }.bind(this)\n      );\n    }\n\n    getAiResponse(promptdata) {\n      $(\"#loader\").removeClass(\"d-none\");\n      Ajax.call([\n        {\n          methodname: \"mod_smartlink_prompt_openai\",\n          args: { contextid: this.contextid, jsondata: JSON.stringify(promptdata) },\n          done: this.handleResponse.bind(this),\n          fail: this.handleFailure.bind(this),\n        },\n      ]);\n    }\n\n    // On a succesful response\n    handleResponse(response) {\n      $(\"#loader\").addClass(\"d-none\");\n      var responseObj = JSON.parse(response);\n\n      if ($(\"#ownPromptModal\").is(\":visible\")) {\n        $(\"#ownPromptModal\").modal(\"toggle\");\n      }\n\n      // Might contain errors anyway\n      if (responseObj.success == false) {\n        alert(responseObj.message);\n      } else {\n        var data = responseObj.data;\n        $(\".prompt-desc\").html(data.description);\n        $(\".prompt-text\").html(data.prompt_text);\n        $(\".ai-response\").html(data.result.replace(/\\n/g, \"<br/>\"));\n        $(\"#responseModal\").modal(\"toggle\");\n      }\n    }\n\n    // Failure\n    handleFailure(response) {\n      $(\"#loader\").addClass(\"d-none\");\n      var responseObj = JSON.parse(response);\n      alert(responseObj.message);\n    }\n  }\n\n  return {\n    init: function (prompts, courseid, instanceid) {\n      return new SmartLinkActions(prompts, courseid, instanceid);\n    },\n  };\n});\n"],"names":["define","$","Str","Ajax","SmartLinkActions","constructor","prompts","courseid","instanceid","Object","values","contextid","init","on","reset","document","click","async","e","target","id","confimationMsg","get_string","confirm","modal","preventDefault","attrVal","currentTarget","attr","promptSetting","this","find","prompt","getAiResponse","promptid","bind","promptVal","val","promptdata","removeClass","call","methodname","args","jsondata","JSON","stringify","done","handleResponse","fail","handleFailure","response","addClass","responseObj","parse","is","success","alert","message","data","html","description","prompt_text","result","replace"],"mappings":"AAAAA,yCAAO,CAAC,SAAU,WAAY,cAAc,SAAUC,EAAGC,IAAKC,YACtDC,iBACJC,YAAYC,QAASC,SAAUC,iBACxBF,QAAUG,OAAOC,OAAOJ,cACxBC,SAAWA,cACXC,WAAaA,gBACbG,UAAY,OACZC,OAGPA,OACEX,EAAE,UAAUY,GAAG,mBAAmB,WAChCZ,EAAE,mCAAmC,GAAGa,WAG1Cb,EAAE,0BAA0BY,GAAG,SAAS,WACtCZ,EAAE,mCAAmC,GAAGa,WAI1Cb,EAAEc,UAAUC,OAAMC,eAAgBC,MACZ,mBAAhBA,EAAEC,OAAOC,GAAyB,KAChCC,qBAAuBnB,IAAIoB,WAAW,6BAA8B,aACpEC,QAAQF,iBACVpB,EAAE,wBAAwBuB,MAAM,eAE7B,GAAoB,kBAAhBN,EAAEC,OAAOC,GAAwB,CACtCC,qBAAuBnB,IAAIoB,WAAW,+BAAgC,aACtEC,QAAQF,iBACVpB,EAAE,mBAAmBuB,MAAM,cAKjCvB,EAAE,mBAAmBe,MACnB,SAAUE,GACRA,EAAEO,qBACEC,QAAUzB,EAAEiB,EAAES,eAAeC,KAAK,WAClCC,cAAgBC,KAAKxB,QAAQyB,MAAMC,QAAWA,OAAOZ,IAAMM,UAC3DG,oBACGI,cAAc,CAAEC,SAAUL,cAAcT,GAAIb,SAAUuB,KAAKvB,SAAUC,WAAYsB,KAAKtB,cAE7F2B,KAAKL,OAET7B,EAAE,0BAA0Be,MAC1B,SAAUE,GACRA,EAAEO,qBACEW,UAAYnC,EAAE,2BAA2BoC,WACxCJ,cAAc,CAAED,OAAQI,UAAW7B,SAAUuB,KAAKvB,SAAUC,WAAYsB,KAAKtB,cAClF2B,KAAKL,OAIXG,cAAcK,YACZrC,EAAE,WAAWsC,YAAY,UACzBpC,KAAKqC,KAAK,CACR,CACEC,WAAY,8BACZC,KAAM,CAAE/B,UAAWmB,KAAKnB,UAAWgC,SAAUC,KAAKC,UAAUP,aAC5DQ,KAAMhB,KAAKiB,eAAeZ,KAAKL,MAC/BkB,KAAMlB,KAAKmB,cAAcd,KAAKL,SAMpCiB,eAAeG,UACbjD,EAAE,WAAWkD,SAAS,cAClBC,YAAcR,KAAKS,MAAMH,aAEzBjD,EAAE,mBAAmBqD,GAAG,aAC1BrD,EAAE,mBAAmBuB,MAAM,UAIF,GAAvB4B,YAAYG,QACdC,MAAMJ,YAAYK,aACb,KACDC,KAAON,YAAYM,KACvBzD,EAAE,gBAAgB0D,KAAKD,KAAKE,aAC5B3D,EAAE,gBAAgB0D,KAAKD,KAAKG,aAC5B5D,EAAE,gBAAgB0D,KAAKD,KAAKI,OAAOC,QAAQ,MAAO,UAClD9D,EAAE,kBAAkBuB,MAAM,WAK9ByB,cAAcC,UACZjD,EAAE,WAAWkD,SAAS,cAClBC,YAAcR,KAAKS,MAAMH,UAC7BM,MAAMJ,YAAYK,gBAIf,CACL7C,KAAM,SAAUN,QAASC,SAAUC,mBAC1B,IAAIJ,iBAAiBE,QAASC,SAAUC"}